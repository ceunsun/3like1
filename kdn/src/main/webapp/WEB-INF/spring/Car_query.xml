<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
	
<mapper namespace="car">
	<select id="search" parameterType="int" resultType="car">
		SELECT *
		FROM car
		WHERE carname = #{carname}
	</select>
	
	<select id="getCount" parameterType="String" resultType="int" >
		SELECT count(*) count
		FROM car
		WHERE carname = #{carname} and carstatus='예약가능'
	</select>
	
	<select id="availableSearch" parameterType="String" resultType="car">
		SELECT *
		FROM car
		WHERE carname = #{carname} and carstatus like '예약%'
	</select>
	
	<select id="returnSearch" resultType="return">
		SELECT returnno, to_char(returndate, 'yyyy/mm/dd') returndate, memberno, carno
		FROM return
	</select>
		
	<select id="reserveSearch" parameterType="String"  resultType="car">
		SELECT c.carno carno, 
			   c.cartype cartype, 
			   c.carstatus carstatus, 
			   c.carimg carimg, 
			   c.carname carname, 
			   r.memberno memberno, 
			   TO_CHAR(r.startdate, 'yyyy/mm/dd') startdate, 
			   TO_CHAR(r.enddate, 'yyyy/mm/dd') enddate, 
			   r.reserveno reserveno
		FROM car c, reservation r
		WHERE c.carno = r.carno and c.carstatus=#{carstatus}
	</select>
	
	<update id="reserveConfirm" parameterType="int">
		UPDATE car	
		SET carstatus='예약완료'
		WHERE carno=#{carno:INTEGER} 
	</update>
	
	<update id="renting"		parameterType="int">
		UPDATE car
		SET carstatus='대여 중'
		WHERE carno=#{carno:INTEGER}
	</update>
	
	<select id="accidentSearch" resultType="accident"> 
		SELECT accidentno, accidentdate, memberno, carno
		FROM accident 
	</select>
	
	<!-- 사고 확인 -->
	<select id="accidentUpdate" parameterType="int">
		UPDATE car 
		SET carstatus = '사고차량' 
		WHERE carno=#{carno} 
	</select>
	
	<insert id="reserve" parameterType="reservation">		
		INSERT INTO reservation 
		VALUES(reservation_seq.nextval, #{startdate}, #{enddate}, #{carno}, #{memberno})
	</insert>
	
	<update id="reserveStatus" parameterType="int">
		UPDATE car	
		SET carstatus='예약대기'
		WHERE carno=#{carno} 
	</update>	
</mapper>